<!DOCTYPE html>
<html
  lang="es"
  xmlns:th="http://www.thymeleaf.org"
  th:replace="~{_layout :: html(~{::title}, ~{::section}, ~{::pageCss}, ~{::pageScript})}">
  <head>
    <title th:text="${pageTitle ?: 'Detalle de Persona - WatchList'}">
      Detalle de Persona
    </title>
    <th:block th:fragment="pageCss"> </th:block>
  </head>
  <body>
    <section th:fragment="section">
      <div
        class="content-container persona-detalle-container"
        th:if="${persona != null}">
        <div class="persona-detalle-header">
          <h1 th:text="${persona.nombre}">Nombre de la Persona</h1>
          <span
            class="persona-detalle-nacimiento"
            th:if="${persona.fechaNac != null}"
            th:text="${#temporals.format(persona.fechaNac, 'd MMMM yyyy')}">
            Fecha de Nacimiento
          </span>
        </div>

        <div class="persona-detalle-main-content">
          <div class="persona-detalle-foto-container">
            <img
              th:if="${persona.fotoUrl != null and not #strings.isEmpty(persona.fotoUrl)}"
              th:src="${persona.fotoUrl}"
              th:alt="${persona.nombre}"
              class="persona-detalle-foto" />
            <div
              th:unless="${persona.fotoUrl != null and not #strings.isEmpty(persona.fotoUrl)}"
              class="persona-detalle-foto-placeholder">
              <span>Sin Foto</span>
            </div>
          </div>

          <div class="persona-detalle-info">
            <div 
              class="info-section persona-detalle-biografia"
              th:if="${persona.biografia != null and not #strings.isEmpty(persona.biografia)}">
              <h2>Biografía</h2>
              <p th:text="${persona.biografia}">Biografía de la persona...</p>
            </div>
          </div>
        </div>

        <div 
          class="info-section persona-detalle-filmografia"
          th:if="${not #lists.isEmpty(persona.participaciones)}">
          <h2>Filmografía</h2>
          
          <div th:if="${not #lists.isEmpty(persona.participaciones.?[rol != null and #strings.equalsIgnoreCase(rol, 'dirección')])}">
            <h3 class="participacion-tipo-titulo">Como Director/a</h3>
            <div class="movie-grid">
              <div class="movie-card" th:each="credito : ${persona.participaciones.?[rol != null and #strings.equalsIgnoreCase(rol, 'dirección')]}">
                <a
                  th:href="@{/peliculas/{id}(id=${credito.media.id})}"
                  class="movie-card-link"
                  th:title="${credito.media.titulo}">
                  <div class="movie-card-poster-container">
                    <img
                      th:if="${credito.media.urlImagen != null and not #strings.isEmpty(credito.media.urlImagen)}"
                      th:src="${credito.media.urlImagen}"
                      th:alt="${credito.media.titulo}"
                      class="movie-card-poster"
                      loading="lazy" />
                    <div
                      th:unless="${credito.media.urlImagen != null and not #strings.isEmpty(credito.media.urlImagen)}"
                      class="movie-card-poster-placeholder">
                      <span>Sin Póster</span>
                    </div>
                  </div>
                  <div class="movie-card-info">
                    <h3 class="movie-card-title" th:text="${credito.media.titulo}">
                      Título de la Película
                    </h3>
                    <p class="movie-card-year" th:if="${credito.media.anioEstreno != null}" th:text="${credito.media.anioEstreno}">
                      Año
                    </p>
                  </div>
                </a>
              </div>
            </div>
          </div>
          
          <div th:if="${not #lists.isEmpty(persona.participaciones.?[rol != null and (#strings.equalsIgnoreCase(rol, 'actor') or #strings.equalsIgnoreCase(rol, 'actriz') or #strings.equalsIgnoreCase(rol, 'reparto'))])}">
            <h3 class="participacion-tipo-titulo">Como Actor/Actriz</h3>
            <div class="movie-grid">
              <div class="movie-card" th:each="credito : ${persona.participaciones.?[rol != null and (#strings.equalsIgnoreCase(rol, 'actor') or #strings.equalsIgnoreCase(rol, 'actriz') or #strings.equalsIgnoreCase(rol, 'reparto'))]}">
                <a
                  th:href="@{/peliculas/{id}(id=${credito.media.id})}"
                  class="movie-card-link"
                  th:title="${credito.media.titulo}">
                  <div class="movie-card-poster-container">
                    <img
                      th:if="${credito.media.urlImagen != null and not #strings.isEmpty(credito.media.urlImagen)}"
                      th:src="${credito.media.urlImagen}"
                      th:alt="${credito.media.titulo}"
                      class="movie-card-poster"
                      loading="lazy" />
                    <div
                      th:unless="${credito.media.urlImagen != null and not #strings.isEmpty(credito.media.urlImagen)}"
                      class="movie-card-poster-placeholder">
                      <span>Sin Póster</span>
                    </div>
                  </div>
                  <div class="movie-card-info">
                    <h3 class="movie-card-title" th:text="${credito.media.titulo}">
                      Título de la Película
                    </h3>
                    <div class="movie-card-credits">
                      <p class="movie-card-year" th:if="${credito.media.anioEstreno != null}" th:text="${credito.media.anioEstreno}">
                        Año
                      </p>
                      <p class="movie-card-character" th:if="${credito.personaje != null and not #strings.isEmpty(credito.personaje)}" th:text="'como ' + ${credito.personaje}">
                        como Personaje
                      </p>
                    </div>
                  </div>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div th:if="${persona == null}" class="content-container">
        <p style="text-align: center; margin-top: 50px">
          Persona no encontrada.
        </p>
      </div>
    </section>
    <th:block th:fragment="pageScript"> </th:block>
  </body>
</html>