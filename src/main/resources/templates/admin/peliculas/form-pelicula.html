<!DOCTYPE html>
<html
  lang="es"
  xmlns:th="http://www.thymeleaf.org"
  th:replace="~{_layout :: html(~{::title}, ~{::section}, ~{::pageCss}, ~{::pageScript})}">
  <head>
    <title th:text="${pageTitle ?: 'Formulario de Película'}">
      Formulario de Película - WatchList
    </title>
    <th:block th:fragment="pageCss">
      <style>
        .form-container {
          max-width: 800px;
          margin: 20px auto;
          padding: 20px;
          background-color: var(--color-grey-2);
          border-radius: 8px;
        }
        .form-group {
          margin-bottom: 1rem;
        }
        .form-group label {
          display: block;
          margin-bottom: 0.5rem;
          color: var(--color-grey-5);
        }
        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group input[type="url"],
        .form-group textarea,
        .form-group select {
          width: 100%;
          padding: 10px 20px;
          margin: 0;
          border: none;
          border-radius: 4px;
          box-sizing: border-box;
          background-color: var(--color-grey-1);
          color: var(--color-grey-5);
        }
        .form-group textarea {
          min-height: 100px;
        }
        .form-group select[multiple] {
          min-height: 120px;
        }
        .form-group .error-message {
          color: var(--color-red-1);
          font-size: 0.9rem;
          margin-top: 0.25rem;
        }
        .form-actions {
          margin-top: 1.5rem;
        }
      </style>
    </th:block>
  </head>
  <body>
    <section>
      <div class="form-container">
        <h2 th:text="${pageTitle ?: 'Formulario de Película'}">
          Formulario de Película
        </h2>

        <div
          th:if="${successMessage}"
          class="alert alert-success"
          th:text="${successMessage}"></div>
        <div
          th:if="${errorMessage}"
          class="alert alert-danger"
          th:text="${errorMessage}"></div>

        <form th:action="${formAction}" th:object="${pelicula}" method="post">
          <div class="form-group">
            <label for="titulo">Título:</label>
            <input type="text" id="titulo" th:field="*{titulo}" />
            <div
              th:if="${#fields.hasErrors('titulo')}"
              th:errors="*{titulo}"
              class="error-message"></div>
          </div>

          <div class="form-group">
            <label for="sinopsis">Sinopsis:</label>
            <textarea id="sinopsis" th:field="*{sinopsis}"></textarea>
            <div
              th:if="${#fields.hasErrors('sinopsis')}"
              th:errors="*{sinopsis}"
              class="error-message"></div>
          </div>

          <div class="form-group">
            <label for="anioEstreno">Año de Estreno:</label>
            <input type="number" id="anioEstreno" th:field="*{anioEstreno}" />
            <div
              th:if="${#fields.hasErrors('anioEstreno')}"
              th:errors="*{anioEstreno}"
              class="error-message"></div>
          </div>

          <div class="form-group">
            <label for="puntuacion">Puntuación (0-10):</label>
            <input
              type="number"
              step="0.1"
              id="puntuacion"
              th:field="*{puntuacion}" />
            <div
              th:if="${#fields.hasErrors('puntuacion')}"
              th:errors="*{puntuacion}"
              class="error-message"></div>
          </div>

          <div class="form-group">
            <label for="urlTrailer"
              >URL del Trailer (YouTube, Vimeo, etc.):</label
            >
            <input
              type="url"
              id="urlTrailer"
              th:field="*{urlTrailer}"
              placeholder="https://www.youtube.com/watch?v=example" />
            <div
              th:if="${#fields.hasErrors('urlTrailer')}"
              th:errors="*{urlTrailer}"
              class="error-message"></div>
          </div>

          <div class="form-group">
            <label for="urlImagen">URL de la Imagen/Póster:</label>
            <input
              type="url"
              id="urlImagen"
              th:field="*{urlImagen}"
              placeholder="https://example.com/poster.jpg" />
            <div
              th:if="${#fields.hasErrors('urlImagen')}"
              th:errors="*{urlImagen}"
              class="error-message"></div>
          </div>

          <div class="form-group">
            <label for="duracionMin">Duración (minutos):</label>
            <input type="number" id="duracionMin" th:field="*{duracionMin}" />
            <div
              th:if="${#fields.hasErrors('duracionMin')}"
              th:errors="*{duracionMin}"
              class="error-message"></div>
          </div>

          <div class="form-group">
            <label for="generoIds">Géneros:</label>
            <select
              multiple="multiple"
              id="generoIds"
              name="generoIds"
              class="form-control">
              <option
                th:each="genero : ${allGeneros}"
                th:value="${genero.id}"
                th:text="${genero.nombre}"
                th:selected="${pelicula.generos != null && pelicula.generos.contains(genero)}"></option>
            </select>
          </div>

          <div class="form-group">
            <label for="plataformaIds">Plataformas:</label>
            <select
              multiple="multiple"
              id="plataformaIds"
              name="plataformaIds"
              class="form-control">
              <option
                th:each="plataforma : ${allPlataformas}"
                th:value="${plataforma.id}"
                th:text="${plataforma.nombre}"
                th:selected="${pelicula.plataformas != null && pelicula.plataformas.contains(plataforma)}"></option>
            </select>
          </div>

          <div class="form-group">
            <label for="personaIds">Personas (Actores/Directores):</label>
            <select
              multiple="multiple"
              id="personaIds"
              name="personaIds"
              class="form-control">
              <option
                th:each="persona : ${allPersonas}"
                th:value="${persona.id}"
                th:text="${persona.nombre}"
                th:selected="${pelicula.personas != null && pelicula.personas.contains(persona)}"></option>
            </select>
          </div>

          <div class="form-actions">
            <button type="submit" class="form-button">Guardar Película</button>
            <a
              th:href="@{/admin/peliculas}"
              class="form-button"
              style="background-color: var(--color-grey-4)"
              >Cancelar</a
            >
          </div>
        </form>
      </div>
    </section>
    <th:block th:fragment="pageScript"></th:block>
  </body>
</html>
